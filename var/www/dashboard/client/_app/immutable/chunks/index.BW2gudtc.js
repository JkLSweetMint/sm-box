var f=Object.defineProperty;var m=(d,t,s)=>t in d?f(d,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[t]=s;var r=(d,t,s)=>m(d,typeof t!="symbol"?t+"":t,s);class h{constructor(t){r(this,"name");r(this,"type");r(this,"default");r(this,"fields");this.name=t.name,this.type=t.type??"string",this.fields=t.fields,t.default&&(this.default=this.Parse(t.default))}Field(t){if(t=="")return this;if(this.fields){if(t.includes(".")){const[s,e]=t.split(".",1),i=this.fields.find(n=>n.name==s);return i?i.Field(e):void 0}return this.fields.find(s=>s.name==t)}}Parse(t){switch(this.type){case"string":return`${t}`;case"number":const s=Number(t);return Number.isNaN(s)?0:s;case"boolean":return t=="y"||t=="Y"||t=="yes"||t=="Yes"||t=="t"||t=="T"||t=="true"||t=="True"||t=="1"||t==1||t==!0;case"object":let e={};return typeof t!="object"||this.fields&&this.fields.forEach(i=>e[i.name]=i.Parse(t[i.name])),e;case"date":switch(typeof t){case"string":case"number":return new Date(t);default:return new Date(0)}}}}class c{constructor(t){r(this,"_name");r(this,"_key");r(this,"_fields");r(this,"_onChange");r(this,"_data");this._name=t.name,this._key=t.key??t.name.toLowerCase(),this._fields=t.fields,this._data={},this._onChange=t.onChange}get _dataName(){return`[${this._name}]:`}_FindField(t){if(t.includes(".")){const[s,e]=t.split(".",1),i=this._fields.find(n=>n.name==s);return i?i.Field(e):void 0}return this._fields.find(s=>s.name==t)}_NestedProperty(t,s,e,i=0,n="get"){if(t.length<1||i>=t.length)throw new Error("empty key");const o=t[0];var a=s[o];if(i==t.length-1)switch(n){case"get":return a;case"set":return a=e}if(typeof a!="object")throw new Error(`Incorrect path to property: "${t.slice(0,i+1).join(".")}"`);return this._NestedProperty(t,a,e,i+1,n)}OnChange(t){this._onChange=t}GetProperty(t){const s=this._FindField(t);if(s&&(t=t.trim(),t!=""))return t.includes(".")?s.Parse(this._NestedProperty(t.split("."),this._data,void 0,0,"get")):s.Parse(this._data[t])}SetProperty(t,s){const e=this._FindField(t);if(!e)throw new Error(`Unknown field: "${t}"`);if(t=t.trim(),t=="")throw new Error("Empty key");const i=this.GetProperty(t);let n=e.Parse(s);e.default&&(n=n||e.default);const o=e.Parse(n);return t.includes(".")?this._NestedProperty(t.split("."),this._data,e.Parse(n),0,"set"):this._data[t]=e.Parse(n),this._onChange&&this._onChange({field:e,oldValue:i,newValue:o}),this}Clear(){localStorage.removeItem(this._key),this._data={}}Save(){localStorage.setItem(this._key,btoa(this._dataName+JSON.stringify(this._data)))}Load(){const t=localStorage.getItem(this._key);try{const s=t?JSON.parse(atob(t).replace(this._dataName,"")):{};this._data=Object.fromEntries(this._fields.map(e=>{let i=s[e.name],n=i?e.Parse(i):void 0;return e.default&&(n=n||e.default),this._onChange&&this._onChange({field:e,oldValue:void 0,newValue:n}),[e.name,n]}))}catch{throw new Error("Bad decode")}return this}toString(){return this._dataName+JSON.stringify(this._data)}Validate(t){let s={};const e=function(o,a){s[o]={status:"fail",description:a}};for(var i in t){if(i=i.trim(),i=="")continue;var n=t[i];const o=this._FindField(i);if(!o){e(i,`Unknown field: "${i}"`);continue}const a=i.includes(".")?o.Parse(this._NestedProperty(i.split("."),this._data,void 0,0,"get")):o.Parse(this._data[i]);if(n.required&&a==null||a==null||a==""){e(i,"Value is required");continue}if(n.min&&n.min>=0)switch(o.type){case"string":if(a.length<n.min){e(i,`Minimum acceptable length is ${n.min}`);continue}break;case"number":if(a<n.min){e(i,`Minimum acceptable value is ${n.min}`);continue}break}if(n.max&&n.max>=0)switch(o.type){case"string":if(a.length>n.max){e(i,`Maximum acceptable length is ${n.min}`);continue}break;case"number":if(a>n.max){e(i,`Maximum acceptable value is ${n.min}`);continue}break}if(n.blacklist&&n.blacklist.length>0&&n.blacklist.includes(a)){e(i,`Value "${a}" is not allowed`);continue}if(n.whitelist&&n.whitelist.length>0&&!n.whitelist.includes(a)){e(i,`Value "${a}" is not allowed. Allowed values are specified via whitelist: ${JSON.stringify(n.whitelist)}`);continue}}return s}toBase(){return this}toObject(){return JSON.parse(JSON.stringify(this._data))}fromObject(t){const s=Object.entries(t);return this._data=Object.fromEntries(this._fields.map(e=>{const i=s.find(n=>n[0]==e.name)??[e.name,null];return this._onChange&&this._onChange({field:e,oldValue:void 0,newValue:i[1]}),[e.name,e.default?i[1]||e.default:i[1]]})),this}Copy(){let t=new c({name:this._name,fields:this._fields,key:this._key,onChange:this._onChange});return t._data=JSON.parse(JSON.stringify(this._data)),t}}const l=class l extends c{static GetInstance(){return this._instance||(this._instance=new l),this._instance}constructor(t){super({name:"Settings",fields:[new h({name:"theme",type:"string"}),new h({name:"sidebarImage",type:"string"}),new h({name:"direction",type:"string",default:"ltr"}),new h({name:"navbarApperance",type:"string",default:"sticky"}),new h({name:"navbarPosition",type:"string",default:"attached"}),new h({name:"componentStyle",type:"string",default:"default"}),new h({name:"expandNavbar",type:"boolean",default:!1})],onChange:t==null?void 0:t.onChange})}ValidateEntity(){return this.Validate(l._rules)}Copy(){let t=new l({onChange:this._onChange});return t._data=JSON.parse(JSON.stringify(this._data)),t}};r(l,"_rules",{direction:{whitelist:["ltr","rtl"],required:!0},navbarApperance:{whitelist:["sticky","static","hidden"],required:!0},navbarPosition:{whitelist:["attached","separated"],required:!0},componentStyle:{whitelist:["default","bordered"],required:!0}}),r(l,"_instance");let u=l;export{u as S};
